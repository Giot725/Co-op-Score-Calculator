<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Co-op Score Calculator</title>
    <style>
      body {
        display: grid;
        grid-template-columns: 3fr 1fr;
        gap: 10px;
        max-width: 80vw;
        margin: 0 auto;
        padding: 20px;
        font-family: Arial, sans-serif;
      }
      form {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        max-width: 100vw;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
      }
      label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
      }
      input[type="number"] {
        width: calc(100% - 8px);
        padding: 8px;
        margin-bottom: 10px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      select {
        width: calc(100% - 8px);
        padding: 8px;
        margin-bottom: 10px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      button {
        grid-column: span 2; /* Button spans across all three columns */
        width: 100%;
        padding: 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }

      #result {
        display: flex;
        align-items: center;
        padding: 12px;
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <h2>Co-op Score Calculator</h2>
    <br />
    <form id="scoreCalculatorForm">
      <!-- Other input fields -->
      <label for="contractLengthInDays">Contract Length (days):</label>
      <input type="number" id="contractLengthInDays" name="contractLengthInDays" value="0" required /><br />
      <label for="coopSize">Max Size of Co-op:</label>
      <input type="number" id="coopSize" name="coopSize" value="0" required /><br />
      <label for="completionTime">Completion Time (seconds):</label>
      <input type="number" id="completionTime" name="completionTime" value="0" required /><br />
      <label for="coopGoals">Total Number of Goals in the Contract:</label>
      <input type="number" id="coopGoals" name="coopGoals" value="0" required /><br />
      <label for="goalsCompleted">Number of Goals Completed:</label>
      <input type="number" id="goalsCompleted" name="goalsCompleted" value="0" required /><br />
      <label for="grade">Grade (1=C, 2=B, 3=A, 4=AA, 5=AAA):</label>
      <input type="number" id="grade" name="grade" value="0" required /><br />
      <label for="yourContribution">Number of Eggs You Have Delivered:</label>
      <input type="number" id="yourContribution" name="yourContribution" step="0.00001" value="0" required />
      <select id="yourContributionDropdown" style="width: calc(100% - 8px)">
        <option value="0">K</option>
        <option value="1">M</option>
        <option value="2">B</option>
        <option value="3">T</option>
        <option value="4">q</option>
        <option value="5">Q</option>
        <option value="6">s</option>
        <option value="7">S</option>
        <option value="8">o</option>
        <option value="9">N</option>
        <option value="10">d</option>
        <option value="11">U</option>
        <option value="12">D</option>
        <option value="13">Td</option>
        <option value="14">qd</option>
        <option value="15">Qd</option>
        <option value="16">sd</option>
        <option value="17">Sd</option>
        <option value="18">Od</option>
        <option value="19">Nd</option>
        <option value="20">V</option>
        <option value="21">uV</option>
        <option value="22">dV</option>
        <option value="23">tV</option>
        <option value="24">qV</option>
        <option value="25">QV</option>
        <option value="26">sV</option>
        <option value="27">SV</option>
        <option value="28">OV</option>
        <option value="29">NV</option>
        <option value="30">tT</option>
      </select>
      <label for="eggsDelivered">Total Eggs Delivered by Everyone in Co-op:</label>
      <input type="number" id="eggsDelivered" name="eggsDelivered" step="0.00001" value="0" required />
      <select id="eggsDeliveredDropdown" style="width: calc(100% - 8px)">
        <option value="0">K</option>
        <option value="1">M</option>
        <option value="2">B</option>
        <option value="3">T</option>
        <option value="4">q</option>
        <option value="5">Q</option>
        <option value="6">s</option>
        <option value="7">S</option>
        <option value="8">o</option>
        <option value="9">N</option>
        <option value="10">d</option>
        <option value="11">U</option>
        <option value="12">D</option>
        <option value="13">Td</option>
        <option value="14">qd</option>
        <option value="15">Qd</option>
        <option value="16">sd</option>
        <option value="17">Sd</option>
        <option value="18">Od</option>
        <option value="19">Nd</option>
        <option value="20">V</option>
        <option value="21">uV</option>
        <option value="22">dV</option>
        <option value="23">tV</option>
        <option value="24">qV</option>
        <option value="25">QV</option>
        <option value="26">sV</option>
        <option value="27">SV</option>
        <option value="28">OV</option>
        <option value="29">NV</option>
        <option value="30">tT</option>
      </select>
      <label for="shipTime">Ship in a Bottle Time Equipped (seconds):</label>
      <input type="number" id="shipTime" name="shipTime" value="0" /><br />
      <label for="shipBuff">Ship in a Bottle Percent Boost:</label>
      <input type="number" id="shipBuff" name="shipBuff" value="0" /><br />
      <label for="deflectorTime">Tachyon Deflector Time Equipped (seconds):</label>
      <input type="number" id="deflectorTime" name="deflectorTime" value="0"/><br />
      <label for="deflectorBuff">Tachyon Deflector Percent Boost:</label>
      <input type="number" id="deflectorBuff" name="deflectorBuff" value="0" /><br />
      <label for="chickenRunsSent">Chicken Runs Sent to Co-op Members:</label>
      <input type="number" id="chickenRunsSent" name="chickenRunsSent" value="0" /><br />
      <label for="tokenValuesSent">Number of Boost Tokens Sent:</label>
      <input type="number" id="tokenValuesSent" name="tokenValuesSent" value="0" /><br />
      <label for="tokenValuesReceived">Number of Boost Tokens Received:</label>
      <input type="number" id="tokenValuesReceived" name="tokenValuesReceived" value="0" /><br />
      <label for="tokenTime">Boost Token Interval (Minutes):</label>
      <input type="number" id="tokenTime" name="tokenTime" value="0" required /><br />
      <button type="submit">Calculate Score</button>
      <div id="scoreContainer">
        <div id="result">Score:</div>
      </div>
    </form>

    <script>
      document
        .getElementById("scoreCalculatorForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          calculateScore();
        });

      function calculateScore() {
        var formData = new FormData(
          document.getElementById("scoreCalculatorForm")
        );

        var contractLengthInDays = parseInt(
          formData.get("contractLengthInDays")
        );
        var contractLengthInSeconds = contractLengthInDays * 86400;
        var coopSize = parseInt(formData.get("coopSize"));
        var completionTime = parseFloat(formData.get("completionTime"));
        var coopGoals = parseInt(formData.get("coopGoals"));
        var goalsCompleted = parseInt(formData.get("goalsCompleted"));
        var grade = parseInt(formData.get("grade"));
        var yourContribution = parseFloat(formData.get("yourContribution"));
        var eggsDelivered = parseFloat(formData.get("eggsDelivered"));
        var shipTime = parseFloat(formData.get("shipTime"));
        var shipBuff = parseFloat(formData.get("shipBuff"));
        var deflectorTime = parseFloat(formData.get("deflectorTime"));
        var deflectorBuff = parseFloat(formData.get("deflectorBuff"));
        var chickenRunsSent = parseInt(formData.get("chickenRunsSent"));
        var tokenValuesSent = parseInt(formData.get("tokenValuesSent"));
        var tokenValuesReceived = parseInt(formData.get("tokenValuesReceived"));
        var tokenTime = parseInt(formData.get("tokenTime")) * 60;

        // Calculate g
        let g;
        if (goalsCompleted >= 1) {
          g = goalsCompleted / coopGoals;
        } else {
          g = 0;
        }
        // Calculate G
        const gradeMapping = { 5: 7, 4: 5, 3: 3.5, 2: 2, 1: 1 };
        let G = gradeMapping[grade] || 0;
        // Calculate ratio
        let ratio = (yourContribution * coopSize) / eggsDelivered;
        // Calculate C
        let C;
        if (ratio <= 2.5) {
          C = 1 + 3 * Math.pow(ratio, 0.15);
        } else {
          C = 1 + 3.386486 + 0.02221 * Math.min(ratio, 12.5);
        }
        // Calculate B
        let tShip = shipTime * shipBuff;
        let tDeflector = deflectorTime * deflectorBuff * 10;
        let t = 0.0075 * (tShip + tDeflector);
        let B = 5 * Math.min(2, t / completionTime);
        // Calculate R
        let R = Math.min(6,chickenRunsSent * Math.max(0.3, 12 / (coopSize * contractLengthInDays)));
        // Calculate T
        let A = completionTime / tokenTime;
        let V;
        if (A <= 42) {
          V = 3;
        } else {
          V = 0.07 * A;
        }
        let T = 2 * ((Math.min(V, tokenValuesSent) + 4 * Math.min(V, Math.max(0, tokenValuesSent - tokenValuesReceived))) / V);
        // Calculate final score
        let score = Math.round(
          187.5 * g * G * C * (1 + contractLengthInDays / 3) * (1 + 4 * Math.pow(1 - completionTime / contractLengthInSeconds, 3)) * (1 + (B + R + T) / 100));

        // Update Score
        document.getElementById("result").innerText = "Score: " + score;
      }
    </script>
  </body>
</html>
